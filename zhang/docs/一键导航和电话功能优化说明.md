# 📞 一键导航和电话功能优化说明

**优化时间：** 2024-11-27  
**优化内容：** 多平台支持、智能设备检测、多地图选择

---

## ✅ 已完成的优化

### 1. 创建导航工具函数 ✅

**文件：** `lib/navigation-utils.ts`

**功能：**

- ✅ 自动检测设备类型（iOS/Android/桌面端）
- ✅ 智能选择最佳地图应用
- ✅ 支持多地图：Apple Maps、Google Maps、高德地图、百度地图、腾讯地图
- ✅ 优化的电话拨打（桌面端自动复制号码）
- ✅ 地址复制功能

---

### 2. 导航功能优化 ✅

#### iOS设备

- 自动使用 **Apple Maps**
- URL格式：`https://maps.apple.com/?daddr=...`

#### Android设备

- 优先尝试打开 **高德地图**（如果已安装）
- 如果没有高德地图，使用 **Google Maps**
- 支持应用内打开或网页打开

#### 桌面端

- 使用 **Google Maps** 网页版
- 提供清晰的地图链接

#### 多地图选择

在联系人弹窗中，新增了三个地图按钮：

- **高德地图** - 国内用户常用
- **百度地图** - 国内用户常用
- **Google地图** - 国际用户常用

---

### 3. 电话功能优化 ✅

#### 移动端

- 直接拨打：`tel:18736396660`
- 立即启动拨号界面

#### 桌面端

- 自动复制电话号码到剪贴板
- 显示友好提示："电话号码已复制，请在手机上拨打"
- 降级方案：如果剪贴板API不可用，使用传统复制方法

---

## 🎯 使用场景

### 场景1：移动端用户点击"一键导航"

1. iOS用户 → 自动打开Apple Maps
2. Android用户 → 优先打开高德地图，否则Google Maps
3. 显示导航路线

### 场景2：桌面端用户点击"一键导航"

1. 自动打开Google Maps网页版
2. 显示目的地和路线规划

### 场景3：移动端用户点击"呼叫"

1. 直接启动拨号界面
2. 显示电话号码
3. 用户点击拨打

### 场景4：桌面端用户点击"呼叫"

1. 自动复制电话号码
2. 显示提示："电话号码已复制，请在手机上拨打"
3. 用户可以在手机上粘贴并拨打

---

## 📱 多地图支持

### 高德地图

- **移动端**：`androidamap://navi?...`（应用内打开）
- **桌面端**：`https://uri.amap.com/navigation?...`（网页版）

### 百度地图

- **移动端**：`baidumap://map/direction?...`（应用内打开）
- **桌面端**：`https://api.map.baidu.com/direction?...`（网页版）

### 腾讯地图

- **移动端**：`qqmap://map/routeplan?...`（应用内打开）
- **桌面端**：`https://apis.map.qq.com/uri/v1/routeplan?...`（网页版）

### Google Maps

- **所有平台**：`https://www.google.com/maps/dir/?api=1&destination=...`

### Apple Maps

- **iOS**：`https://maps.apple.com/?daddr=...`

---

## 🔧 技术实现

### 设备检测

```typescript
function detectDevice(): 'ios' | 'android' | 'desktop' {
  const ua = navigator.userAgent.toLowerCase()
  if (/iphone|ipad|ipod/.test(ua)) return 'ios'
  if (/android/.test(ua)) return 'android'
  return 'desktop'
}
```

### 智能导航

```typescript
function openNavigation() {
  const device = detectDevice()
  if (device === 'ios') {
    // Apple Maps
  } else if (device === 'android') {
    // 尝试高德地图，否则Google Maps
  } else {
    // Google Maps网页版
  }
}
```

### 智能电话

```typescript
function makeCall(phone: string) {
  if (detectDevice() === 'desktop') {
    // 复制号码并提示
    navigator.clipboard.writeText(phone)
    alert('电话号码已复制，请在手机上拨打')
  } else {
    // 直接拨打
    window.location.href = `tel:${phone}`
  }
}
```

---

## 📋 更新的组件

1. ✅ `components/wedding/schedule-section.tsx` - 日程页面导航和呼叫
2. ✅ `components/wedding/modal-contents/contact-modal.tsx` - 联系人弹窗
3. ✅ `components/wedding/floating-ai-button.tsx` - AI助手导航功能
4. ✅ `components/wedding/top-navigation.tsx` - 顶部导航呼叫按钮

---

## 🎊 优化效果

### 之前

- ❌ 只支持Apple Maps（iOS用户）
- ❌ 桌面端无法拨打电话
- ❌ 没有多地图选择

### 现在

- ✅ 自动检测设备，选择最佳地图
- ✅ 桌面端智能处理（复制号码）
- ✅ 支持5种地图应用
- ✅ 移动端和桌面端都有良好体验

---

## 🧪 测试建议

### 移动端测试

1. iOS设备：测试Apple Maps打开
2. Android设备：测试高德地图和Google Maps
3. 测试电话拨打功能

### 桌面端测试

1. 测试Google Maps打开
2. 测试电话号码复制功能
3. 测试多地图选择按钮

---

**所有优化已完成！现在一键导航和电话功能在所有设备上都能完美工作！** 🎉
