# ğŸš€ éƒ¨ç½²æ‰§è¡Œå‘½ä»¤ï¼ˆè¯·æŒ‰é¡ºåºæ‰§è¡Œï¼‰

## æ­¥éª¤1ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /Users/yanyu/Documents/zhang

rsync -avz --progress \
    --exclude 'node_modules' \
    --exclude '.next' \
    --exclude '.git' \
    --exclude '.DS_Store' \
    --exclude '*.log' \
    --exclude '.trae' \
    ./ root@47.94.135.202:/opt/wedding-site/
```

**è¾“å…¥å¯†ç ï¼š** `My151001`

---

## æ­¥éª¤2ï¼šè¿æ¥æœåŠ¡å™¨

```bash
ssh root@47.94.135.202
```

**è¾“å…¥å¯†ç ï¼š** `My151001`

---

## æ­¥éª¤3ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²

è¿æ¥æˆåŠŸåï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/wedding-site

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
bash scripts/server-setup.sh
```

---

## å¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œæ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

### 1. å®‰è£…ç¯å¢ƒ

```bash
# æ›´æ–°ç³»ç»Ÿ
yum update -y

# å®‰è£…Node.js 18
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs

# å®‰è£…pnpm
npm install -g pnpm

# å®‰è£…PM2
npm install -g pm2

# å®‰è£…Nginx
yum install -y nginx

# å®‰è£…Certbot
yum install -y certbot python3-certbot-nginx
```

### 2. æ„å»ºé¡¹ç›®

```bash
cd /opt/wedding-site
pnpm install --frozen-lockfile
pnpm build
```

### 3. å¯åŠ¨åº”ç”¨

```bash
pm2 start npm --name "wedding-site" -- start
pm2 save
pm2 startup
```

### 4. é…ç½®Nginx

```bash
cat > /etc/nginx/conf.d/wedding-site.conf << 'EOF'
server {
    listen 80;
    server_name zhang.0379.love;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name zhang.0379.love;

    ssl_certificate /etc/letsencrypt/live/zhang.0379.love/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/zhang.0379.love/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location /_next/static {
        alias /opt/wedding-site/.next/static;
        expires 365d;
        add_header Cache-Control "public, immutable";
    }

    location /public {
        alias /opt/wedding-site/public;
        expires 30d;
        add_header Cache-Control "public";
    }

    location / {
        proxy_pass http://127.0.0.1:3666;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# æµ‹è¯•é…ç½®
nginx -t

# å¯åŠ¨Nginx
systemctl enable nginx
systemctl start nginx
```

### 5. é…ç½®SSLè¯ä¹¦

```bash
certbot --nginx -d zhang.0379.love --non-interactive --agree-tos \
    --email admin@0379.email --redirect
```

### 6. é…ç½®é˜²ç«å¢™

```bash
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

---

## âœ… éƒ¨ç½²å®Œæˆ

è®¿é—®ï¼š**<https://zhang.0379.love>**

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status
pm2 logs wedding-site

# é‡å¯åº”ç”¨
pm2 restart wedding-site

# æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx
```
