# 可复用微透可拖拽弹窗组件规范文档

import type React from "react"

/**

* 可复用微透可拖拽弹窗组件规范文档
*
* 组件路径: components/wedding/draggable-modal.tsx
* 技术栈: React + TypeScript + Framer Motion
 */

// ==================== Props 定义 ====================

export interface DraggableModalProps {
  /** 控制弹窗显示状态 (必填) */
  isOpen: boolean

  /** 关闭回调函数 (必填) - 点击背景/Esc/关闭按钮时触发 */
  onClose: () => void

  /** 弹窗标题 (必填) */
  title: string

  /** 标题左侧图标 (可选) */
  icon?: React.ReactNode

  /** 弹窗内容 (必填) */
  children: React.ReactNode

  /** 初始位置 { x, y } (可选) */
  initialPosition?: { x: number; y: number }

  /** 弹窗宽度 - Tailwind class (默认: "max-w-md") */
  width?: string

  /** 弹窗最大高度 - Tailwind class (默认: "max-h-[80vh]") */
  maxHeight?: string

  /** 是否允许拖拽移动 (默认: true) */
  draggable?: boolean

  /** 是否显示最小化按钮 (默认: true) */
  minimizable?: boolean

  /** 是否显示最大化按钮 (默认: true) */
  maximizable?: boolean

  /** ARIA 标签，用于无障碍 (可选) */
  ariaLabel?: string

  /** ARIA 描述 ID (可选) */
  ariaDescribedBy?: string

  /** 最小化状态变化回调 (可选) */
  onMinimize?: (isMinimized: boolean) => void

  /** 最大化状态变化回调 (可选) */
  onMaximize?: (isMaximized: boolean) => void

  /** 拖拽开始回调 (可选) */
  onDragStart?: () => void

  /** 拖拽结束回调，返回最终位置 (可选) */
  onDragEnd?: (position: { x: number; y: number }) => void

  /** 禁用背景点击关闭 (默认: false) */
  disableBackdropClose?: boolean

  /** 禁用 Esc 键关闭 (默认: false) */
  disableEscClose?: boolean

  /** 自定义 z-index (默认: 50) */
  zIndex?: number

  /** 降级模式：禁用模糊动画 (默认: false) */
  reducedMotion?: boolean
}

// ==================== 使用示例 ====================

/**

* 基础使用示例
 */
export const basicExample = `
import DraggableModal from "@/components/wedding/draggable-modal"
import { Music } from 'lucide-react'
import { useState } from "react"

function Example() {
  const [isOpen, setIsOpen] = useState(false)
  
  return (
    <>
      <button onClick={() => setIsOpen(true)}>打开弹窗</button>

      <DraggableModal
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
        title="音乐播放器"
        icon={<Music className="w-5 h-5" />}
        draggable={true}
        width="max-w-lg"
      >
        <div className="p-4">弹窗内容</div>
      </DraggableModal>
    </>
  )
}
`

/**

* 带事件处理的完整示例
 */
export const fullExample = `
import DraggableModal from "@/components/wedding/draggable-modal"
import { Settings } from 'lucide-react'
import { useState, useCallback } from "react"

function AdvancedExample() {
  const [isOpen, setIsOpen] = useState(false)
  const [position, setPosition] = useState({ x: 0, y: 0 })
  
  // onClose 事件处理 - 点击背景/Esc/关闭按钮时触发
  const handleClose = useCallback(() => {
    console.log("弹窗关闭，最后位置:", position)
    setIsOpen(false)
  }, [position])
  
  // draggable 相关事件处理
  const handleDragStart = useCallback(() => {
    console.log("开始拖拽")
  }, [])
  
  const handleDragEnd = useCallback((newPosition: { x: number; y: number }) => {
    console.log("拖拽结束，新位置:", newPosition)
    setPosition(newPosition)
  }, [])
  
  return (
    <DraggableModal
      isOpen={isOpen}
      onClose={handleClose}
      title="设置面板"
      icon={React.createElement(Settings, { className: "w-5 h-5" })}

      // 拖拽配置
      draggable={true}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
      initialPosition={{ x: 100, y: 50 }}
      
      // 窗口控制
      minimizable={true}
      maximizable={true}
      onMinimize={(isMin) => console.log("最小化:", isMin)}
      onMaximize={(isMax) => console.log("最大化:", isMax)}
      
      // 关闭行为
      disableBackdropClose={false}
      disableEscClose={false}
      
      // 尺寸与无障碍
      width="max-w-xl"
      maxHeight="max-h-[70vh]"
      ariaLabel="设置面板弹窗"
      
      // 性能降级
      reducedMotion={false}
    >
      <div className="p-6">
        <p>完整功能演示</p>
      </div>
    </DraggableModal>
  )
}
`

// ==================== 动画规范 ====================

export const animationSpec = {
  // 弹入动画
  enter: {
    duration: "350ms",
    easing: "cubic-bezier(0.34, 1.56, 0.64, 1)", // 弹簧回弹
    properties: ["scale: 0.9 → 1", "blur: 20px → 0", "opacity: 0 → 1"],
    shadow: "阶段性加深 shadow-lg → shadow-xl",
  },
  // 弹出动画
  exit: {
    duration: "250ms",
    easing: "ease-out",
    properties: ["scale: 1 → 0.9", "blur: 0 → 12px", "opacity: 1 → 0"],
  },
  // 背景遮罩
  backdrop: {
    blur: "12px",
    backgroundColor: "rgba(38, 38, 38, 0.4)", // graphite/40
    transition: "300ms",
  },
  // 降级策略
  reducedMotion: {
    description: "禁用 blur 滤镜，仅保留 opacity 和 scale 过渡",
    duration: "200ms",
    easing: "ease-out",
  },
}

// ==================== 无障碍规范 ====================

export const a11ySpec = {
  keyboard: {
    Escape: "关闭弹窗（可通过 disableEscClose 禁用）",
    Tab: "焦点在弹窗内循环（焦点陷阱）",
    "Shift+Tab": "反向焦点循环",
  },
  aria: {
    role: "dialog",
    "aria-modal": "true",
    "aria-label": "弹窗标题（可自定义）",
    "aria-labelledby": "modal-title",
    "aria-describedby": "可选的描述ID",
  },
  focus: {
    open: "自动聚焦第一个可聚焦元素",
    close: "焦点返回触发元素（需外部实现）",
  },
}
