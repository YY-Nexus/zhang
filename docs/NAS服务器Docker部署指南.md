# ğŸ³ NAS æœåŠ¡å™¨ Docker éƒ¨ç½²æŒ‡å—

**é€‚ç”¨ç³»ç»Ÿï¼š** TANKS ç³»ç»Ÿï¼ˆå›¾å½¢åŒ– Docker ç®¡ç†ï¼‰

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æ£€æŸ¥ Docker ç¯å¢ƒ

åœ¨ TANKS ç³»ç»Ÿä¸­ç¡®è®¤ï¼š

- âœ… Docker å·²å®‰è£…å¹¶è¿è¡Œ
- âœ… Docker Manager å¯ä»¥æ­£å¸¸ä½¿ç”¨
- âœ… æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼ˆå»ºè®®è‡³å°‘ 5GBï¼‰

### 2. å‡†å¤‡é¡¹ç›®æ–‡ä»¶

ç¡®ä¿é¡¹ç›®æ–‡ä»¶å·²ä¸Šä¼ åˆ° NAS æœåŠ¡å™¨ï¼Œå»ºè®®è·¯å¾„ï¼š

```
/volume1/docker/wedding-site/
æˆ–
/opt/wedding-site/
```

---

## ğŸš€ æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ° NAS

å°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ä¸Šä¼ åˆ° NAS æœåŠ¡å™¨ã€‚

### æ­¥éª¤ 2ï¼šåœ¨ TANKS ç³»ç»Ÿä¸­åˆ›å»ºé¡¹ç›®

1. æ‰“å¼€ **Docker Manager**
2. è¿›å…¥ **"é¡¹ç›®"** (Projects) é¡µé¢
3. ç‚¹å‡» **"æ–°å»ºé¡¹ç›®"** æˆ– **"å¯¼å…¥"**
4. é€‰æ‹©é¡¹ç›®ç›®å½•ï¼š`/volume1/docker/wedding-site/`ï¼ˆæˆ–æ‚¨çš„å®é™…è·¯å¾„ï¼‰

### æ­¥éª¤ 3ï¼šä½¿ç”¨ docker-compose.yml

TANKS ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ« `docker-compose.yml` æ–‡ä»¶ï¼Œæˆ–è€…ï¼š

1. åœ¨é¡¹ç›®é¡µé¢ç‚¹å‡» **"ç¼–è¾‘"** æˆ– **"é…ç½®"**
2. é€‰æ‹©ä½¿ç”¨ `docker-compose.yml`
3. ç‚¹å‡» **"å¯åŠ¨"** æˆ– **"éƒ¨ç½²"**

---

## ğŸ¨ æ–¹å¼äºŒï¼šå›¾å½¢åŒ–æ“ä½œï¼ˆTANKS ç³»ç»Ÿï¼‰

### æ­¥éª¤ 1ï¼šåˆ›å»ºå®¹å™¨

1. æ‰“å¼€ **Docker Manager**
2. è¿›å…¥ **"å®¹å™¨"** (Containers) é¡µé¢
3. ç‚¹å‡» **"æ–°å»ºå®¹å™¨"** æˆ– **"+"**

### æ­¥éª¤ 2ï¼šé…ç½®å®¹å™¨

#### åŸºæœ¬ä¿¡æ¯

- **å®¹å™¨åç§°ï¼š** `zhang-wedding-site`
- **é•œåƒï¼š** é€‰æ‹© **"ä» Dockerfile æ„å»º"** æˆ–ä½¿ç”¨é¢„æ„å»ºé•œåƒ

#### ç«¯å£æ˜ å°„

- **ä¸»æœºç«¯å£ï¼š** `3666`
- **å®¹å™¨ç«¯å£ï¼š** `3000`
- **åè®®ï¼š** `TCP`

#### å·/å­˜å‚¨

- **æºè·¯å¾„ï¼š** `/volume1/docker/wedding-site/public`
- **ç›®æ ‡è·¯å¾„ï¼š** `/app/public`
- **æƒé™ï¼š** `åªè¯» (ro)`

#### ç¯å¢ƒå˜é‡

```
NODE_ENV=production
PORT=3000
NEXT_TELEMETRY_DISABLED=1
```

#### é‡å¯ç­–ç•¥

- é€‰æ‹© **"é™¤éåœæ­¢"** (unless-stopped)

### æ­¥éª¤ 3ï¼šæ„å»ºé•œåƒï¼ˆå¦‚æœä½¿ç”¨ Dockerfileï¼‰

1. åœ¨ **"é•œåƒ"** (Images) é¡µé¢
2. ç‚¹å‡» **"æ„å»º"** æˆ– **"Build"**
3. é€‰æ‹©é¡¹ç›®ç›®å½•
4. é€‰æ‹© `Dockerfile.nas`ï¼ˆNAS ä¼˜åŒ–ç‰ˆï¼‰
5. ç‚¹å‡» **"æ„å»º"**

### æ­¥éª¤ 4ï¼šå¯åŠ¨å®¹å™¨

1. åœ¨å®¹å™¨åˆ—è¡¨ä¸­æ‰¾åˆ° `zhang-wedding-site`
2. ç‚¹å‡» **"å¯åŠ¨"** æˆ– **"â–¶ï¸"**

---

## ğŸ”§ æ–¹å¼ä¸‰ï¼šå‘½ä»¤è¡Œéƒ¨ç½²ï¼ˆå¦‚æœæ”¯æŒ SSHï¼‰

### æ­¥éª¤ 1ï¼šè¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /volume1/docker/wedding-site
# æˆ–
cd /opt/wedding-site
```

### æ­¥éª¤ 2ï¼šæ„å»ºé•œåƒ

```bash
docker build -f Dockerfile.nas -t zhang-wedding-site:latest .
```

### æ­¥éª¤ 3ï¼šå¯åŠ¨å®¹å™¨

```bash
docker-compose -f docker-compose.nas.yml up -d
```

æˆ–ä½¿ç”¨ docker runï¼š

```bash
docker run -d \
  --name zhang-wedding-site \
  --restart unless-stopped \
  -p 3666:3000 \
  -v $(pwd)/public:/app/public:ro \
  -e NODE_ENV=production \
  -e PORT=3000 \
  zhang-wedding-site:latest
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

åœ¨ TANKS ç³»ç»Ÿçš„ **"æ€»è§ˆ"** æˆ– **"å®¹å™¨"** é¡µé¢ï¼š

- âœ… å®¹å™¨çŠ¶æ€æ˜¾ç¤º **"è¿è¡Œä¸­"** (Running)
- âœ… CPU å’Œå†…å­˜ä½¿ç”¨æ­£å¸¸
- âœ… æ²¡æœ‰é”™è¯¯æ—¥å¿—

### 2. è®¿é—®ç½‘ç«™

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

- **<http://NAS-IP:3666>**
- æˆ–é…ç½®åå‘ä»£ç†åè®¿é—®ï¼š**<https://zhang.0379.love>**

### 3. æŸ¥çœ‹æ—¥å¿—

åœ¨ TANKS ç³»ç»Ÿä¸­ï¼š

1. è¿›å…¥ **"æ—¥å¿—"** (Logs) é¡µé¢
2. é€‰æ‹©å®¹å™¨ `zhang-wedding-site`
3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰é”™è¯¯

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šå›¾å½¢åŒ–æ›´æ–°

1. åœ¨ TANKS ç³»ç»Ÿä¸­åœæ­¢å®¹å™¨
2. åˆ é™¤æ—§å®¹å™¨ï¼ˆå¯é€‰ï¼‰
3. é‡æ–°æ„å»ºé•œåƒï¼ˆå¦‚æœæœ‰ä»£ç æ›´æ–°ï¼‰
4. é‡æ–°å¯åŠ¨å®¹å™¨

### æ–¹å¼äºŒï¼šä½¿ç”¨ docker-compose

```bash
cd /volume1/docker/wedding-site
docker-compose -f docker-compose.nas.yml pull  # å¦‚æœæœ‰æ–°é•œåƒ
docker-compose -f docker-compose.nas.yml up -d --build
```

---

## ğŸŒ é…ç½®åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é€šè¿‡åŸŸåè®¿é—®ï¼Œé…ç½® Nginx åå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name zhang.0379.love;

    location / {
        proxy_pass http://localhost:3666;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

## ğŸ“Š èµ„æºç›‘æ§

åœ¨ TANKS ç³»ç»Ÿçš„ **"æ€»è§ˆ"** é¡µé¢å¯ä»¥ç›‘æ§ï¼š

- **CPU ä½¿ç”¨ç‡ï¼š** æ­£å¸¸åº” < 10%
- **å†…å­˜ä½¿ç”¨ï¼š** æ­£å¸¸åº” < 1GB
- **å®¹å™¨çŠ¶æ€ï¼š** åº”æ˜¾ç¤º"è¿è¡Œä¸­"

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨

**æ£€æŸ¥ï¼š**

1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
3. æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³

**è§£å†³ï¼š**

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs zhang-wedding-site

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 3666
```

### é—®é¢˜ 2ï¼šç½‘ç«™æ— æ³•è®¿é—®

**æ£€æŸ¥ï¼š**

1. å®¹å™¨æ˜¯å¦è¿è¡Œ
2. ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®
3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3666 ç«¯å£

### é—®é¢˜ 3ï¼šé™æ€èµ„æºæ— æ³•åŠ è½½

**æ£€æŸ¥ï¼š**

1. å·æŒ‚è½½æ˜¯å¦æ­£ç¡®
2. æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®
3. è·¯å¾„æ˜¯å¦æ­£ç¡®

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep wedding

# æŸ¥çœ‹æ—¥å¿—
docker logs zhang-wedding-site

# é‡å¯å®¹å™¨
docker restart zhang-wedding-site

# åœæ­¢å®¹å™¨
docker stop zhang-wedding-site

# å¯åŠ¨å®¹å™¨
docker start zhang-wedding-site

# åˆ é™¤å®¹å™¨
docker rm zhang-wedding-site

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats zhang-wedding-site
```

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼š

- âœ… å®¹å™¨è¿è¡Œæ­£å¸¸
- âœ… ç½‘ç«™å¯ä»¥è®¿é—®
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ˆç…§ç‰‡ã€è§†é¢‘ã€éŸ³ä¹ï¼‰

**è®¿é—®åœ°å€ï¼š** <http://NAS-IP:3666> æˆ– <https://zhang.0379.love>

---

**ç°åœ¨å¯ä»¥åœ¨ TANKS ç³»ç»Ÿä¸­å¼€å§‹éƒ¨ç½²äº†ï¼** ğŸš€
